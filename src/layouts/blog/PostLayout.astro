---
import '@/styles/blog/global.css';
import type { PostLayoutProps } from '@/types';
import FormattedDate from '@/components/blog/widgets/FormattedDate.astro';
import FootnoteScroll from '@/components/blog/widgets/FootnoteScroll.astro';
import BaseHead from '@/components/blog/layout/BaseHead.astro';
import Footer from '@/components/blog/layout/Footer.astro';
import BackButton from '@/components/blog/ui/BackButton.astro';
import TableOfContents from '@/components/blog/ui/TableOfContents.astro';
import GradientMask from '@/components/blog/ui/GradientMask.astro';
import ImageOptimizer from '@/components/blog/ui/ImageOptimizer.astro';
import ImageViewer from '@/components/blog/ui/ImageViewer.astro';
import GitHubCard from '@/components/blog/ui/GitHubCard.astro';
import LinkCard from '@/components/blog/ui/LinkCard.astro';
import NeoDBCard from '@/components/blog/ui/NeoDBCard.astro';
import XPOST from '@/components/blog/ui/XPOST.astro';
import CopyCode from '@/components/blog/ui/CopyCode.astro';
import BaseLayout from '@/layouts/blog/BaseLayout.astro';

import { themeConfig } from '@/config';

const { title, pubDate, readingTime, toc } = Astro.props as PostLayoutProps;

const postSlug = Astro.url.pathname.split('/').filter(Boolean).pop() || '';
const ogImage = `/open-graph/${postSlug}.png`;
---

<BaseLayout
	title={`${title} · ${themeConfig.site.title}`}
	description={themeConfig.site.description}
	type="post"
>
	<BaseHead
		title={`${title} · ${themeConfig.site.title}`}
		description={themeConfig.site.description}
		ogImage={ogImage}
		slot="head"
	/>
	<div class="post-container">
		<main>
			<div class="prose">
				<GradientMask />
				<BackButton />
				{themeConfig.post.toc && <TableOfContents toc={toc} />}
				<div class="title">
					<h1>{title}</h1>
					<div class="date">
						<FormattedDate date={pubDate} context="post" />
						{
							themeConfig.post.readingTime && readingTime && (
								<span class="reading-time">
									<span class="separator">·</span>
									{readingTime.text}
								</span>
							)
						}
					</div>
				</div>
				<slot />
			</div>
		</main>
		<ImageOptimizer />
		<FootnoteScroll />
		<CopyCode />
		<GitHubCard />
		<XPOST />
		<NeoDBCard />
		{themeConfig.post.imageViewer && <ImageViewer />}
		{themeConfig.post.linkCard && <LinkCard />}
		{themeConfig.general.footer && <Footer />}
	</div>
</BaseLayout>

<style>
	.post-container {
		display: flex;
		flex-direction: column;
		flex: 1;
	}

	.post-container main {
		flex: 1;
	}
</style>
